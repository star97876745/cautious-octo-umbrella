<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>📊 جدول + حاسبة مع زر IDE</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#0f172a;--text:#e5e7eb;--card-bg:#111827;
  --accent:#2563eb;--accent-hover:#3b82f6;
  --table-header:#1e293b;--table-row-alt:#111827;
  --success-bg:#064e3b;--success-text:#d1fae5;
}
.light{
  --bg:#f8fafc;--text:#111827;--card-bg:#ffffff;
  --accent:#1d4ed8;--accent-hover:#2563eb;
  --table-header:#e2e8f0;--table-row-alt:#f1f5f9;
  --success-bg:#d1fae5;--success-text:#065f46;
}
body{
  font-family:"Segoe UI","Noto Naskh Arabic",sans-serif;
  background:var(--bg);color:var(--text);
  margin:0;padding:20px;transition:background .3s,color .3s;
}
h1,h2{text-align:center;color:var(--accent);}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{padding:10px;border-bottom:1px solid #cbd5e1;text-align:center;}
th{background:var(--table-header);color:var(--accent);}
tr:nth-child(even){background:var(--table-row-alt);}
input{padding:8px;border-radius:8px;border:1px solid #cbd5e1;
  background:var(--card-bg);color:var(--text);margin:5px;}
button{padding:8px 14px;border:none;border-radius:8px;
  background:var(--accent);color:white;cursor:pointer;
  transition:background .3s;}
button:hover{background:var(--accent-hover);}
.card{
  background:var(--card-bg);padding:20px;border-radius:14px;
  max-width:500px;margin:20px auto;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}
#out{margin-top:15px;padding:12px;border-radius:10px;
  background:var(--success-bg);color:var(--success-text);}
</style>
</head>
<body>
<button onclick="toggleTheme()" style="position:fixed;top:10px;left:10px;">🌓</button>

<h1>📊 جدول المنتجات</h1>
<input id="q" placeholder="ابحث باسم أو IDE ..." oninput="filter()" style="width:60%;display:block;margin:10px auto;">

<table>
  <thead>
    <tr><th>المنتج</th><th>IDE</th><th>GDS_MIN</th><th>GDS_MAX</th><th>GDS_YER</th></tr>
  </thead>
  <tbody id="tb"></tbody>
</table>

<div id="calc" class="card" style="display:none">
  <h2>🔎 الحاسبة</h2>
  <div id="prod"></div>
  <label>⚖️ وزن (كغ): <input id="w" type="number"></label><br>
  <label>💵 سعر الصرف: <input id="ex" type="number" value="1320"></label><br>
  <label>🏷️ النسبة %: <input id="rt" type="number" value="6"></label><br>
  <button onclick="calc()">✅ احسب</button>
  <div id="out"></div>
</div>

<script>
let DB=[],VIEW=[],cur=null;
const $=s=>document.querySelector(s);
function fmt(x){const n=Number(x);return isFinite(n)?n.toLocaleString('ar-IQ',{maximumFractionDigits:2}):'-';}
function prep(arr){return arr.map(r=>({product:r.product||r.GDS_DS2,IDE:r.IDE_HSC_NB1||r.IDE,GDS_MIN:+r.GDS_MIN,GDS_MAX:+r.GDS_MAX,GDS_YER:r.GDS_YER?+r.GDS_YER:(+r.GDS_MIN+ +r.GDS_MAX)/2})).filter(r=>r.product);}
function render(){const tb=$("#tb");tb.innerHTML="";VIEW.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`
<td>${r.product} 
  <button onclick="openIDE('${r.IDE||''}')">🔗 IDE</button> 
  <button onclick='openCalc(${JSON.stringify(r)})'>📐 حاسبة</button>
</td>
<td>${r.IDE||"-"}</td><td>${fmt(r.GDS_MIN)}</td><td>${fmt(r.GDS_MAX)}</td><td>${fmt(r.GDS_YER)}</td>`;tb.appendChild(tr);});}
function filter(){const q=$("#q").value.toLowerCase();VIEW=DB.filter(r=>r.product.toLowerCase().includes(q)||(r.IDE||'').toLowerCase().includes(q));render();}
function openCalc(r){cur=r;$("#calc").style.display="block";$("#prod").innerHTML=`<b>${r.product}</b> (IDE:${r.IDE||"-"}) YER=${fmt(r.GDS_YER)}`;}
function calc(){if(!cur)return;const w=+$("#w").value,ex=+$("#ex").value,rt=+$("#rt").value;const d=w*cur.GDS_YER*ex*(rt/100);$("#out").innerHTML=`فرق الرسم: <b>${fmt(d)}</b> دينار`; }
function openIDE(ide){if(!ide){alert("ماكو IDE");return;}window.open("product-search.html?ide="+encodeURIComponent(ide),"_blank");}
fetch('products.json').then(r=>r.json()).then(js=>{DB=prep(js);VIEW=DB;render();});
function toggleTheme(){document.body.classList.toggle("light");}
</script>
</body>
</html>